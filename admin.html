<!doctype html><html lang="en"><head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="/assets/css/styles.css"><title>Admin</title>
<script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
</head><body id="watermark">
<main class="container mt-lg">
  <h1>Admin</h1>
  <section class="card">
    <h2>Reports</h2>
    <div class="grid-3">
      <label>Group<select id="r_org"><option value="pa-2026">PA 2026</option><option value="supreme-2027">Supreme 2027</option><option value="linda">Linda</option></select></label>
      <label>From<input id="r_from" type="date"></label>
      <label>To<input id="r_to" type="date"></label>
    </div>
    <div class="grid-2">
      <label>Report token<input id="r_token" type="password" placeholder="REPORT_TOKEN"></label>
      <div><button class="btn" id="csv">Download CSV</button> <button class="btn" id="xlsx">Download XLSX</button></div>
    </div>
  </section>
</main>
<script>
function buildUrl(fmt){const org=r_org.value, from=r_from.value, to=r_to.value, token=r_token.value; if(!org||!from||!to||!token){alert('Fill all fields'); return null;} return `/api/report?org=${encodeURIComponent(org)}&from=${encodeURIComponent(from)}&to=${encodeURIComponent(to)}&token=${encodeURIComponent(token)}`;}
csv.addEventListener('click',()=>{const u=buildUrl('csv'); if(!u) return; window.location.href=u;});
xlsx.addEventListener('click',async()=>{
  const u=buildUrl('xlsx'); if(!u) return;
  const r=await fetch(u); const text=await r.text();
  const rows=text.trim().split(/\r?\n/).map(line=>line.split(/,(?=(?:[^"]*"[^"]*")*[^"]*$)/).map(s=>s.replace(/^"|"$/g,'').replace(/""/g,'"')));
  const ws=XLSX.utils.aoa_to_sheet(rows); const wb=XLSX.utils.book_new(); XLSX.utils.book_append_sheet(wb, ws, 'Orders');
  XLSX.writeFile(wb, `report_${r_org.value}_${r_from.value}_to_${r_to.value}.xlsx`);
});
</script>
</body></html>